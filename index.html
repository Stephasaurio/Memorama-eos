<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Memorama EOS</title>
  <style>
    body {
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background-color: #f5f5f5;
      margin: 0;
      padding: 1rem;
    }
    h1 {
      color: #0c3c60;
    }
    .board {
      display: grid;
      gap: 10px;
      margin-top: 1rem;
    }
    .card {
      width: 80px;
      height: 80px;
      background-color: #0c3c60;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 24px;
      cursor: pointer;
    }
    .card img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      border-radius: 10px;
    }
    .info, .ranking {
      margin-top: 1rem;
    }
    .ranking {
      display: none;
    }
  </style>
</head>
<body>
  <h1>Memorama EOS</h1>
  <div>
    <label>Nombre de usuario: <input type="text" id="username" /></label>
    <button onclick="startGame()">Iniciar</button>
  </div>
  <div class="info">
    <p>Nivel: <span id="level">1</span> | Tiempo: <span id="time">0</span>s | Puntos: <span id="score">0</span> | Intentos restantes: <span id="attempts">2</span></p>
  </div>
  <div class="board" id="board"></div>
  <div class="ranking" id="ranking"></div>

  <script>
    const board = document.getElementById('board');
    const levelSpan = document.getElementById('level');
    const timeSpan = document.getElementById('time');
    const scoreSpan = document.getElementById('score');
    const attemptsSpan = document.getElementById('attempts');
    const usernameInput = document.getElementById('username');
    const rankingDiv = document.getElementById('ranking');

    const maxPairs = 12;
    let currentLevel = 1;
    let score = 0;
    let timer;
    let remainingTime;
    let flippedCards = [];
    let matchedPairs = 0;
    let attempts = 2;
    let username = '';

    const imageList = Array.from({ length: maxPairs }, (_, i) => `img${i + 1}.png`);

    function getTimeForLevel(pairs) {
      switch (pairs) {
        case 4: return 20;
        case 6: return 35;
        case 8: return 50;
        case 10: return 65;
        case 12: return 80;
        default: return 60;
      }
    }

    function startGame() {
      username = usernameInput.value.trim();
      if (!username) {
        alert('Por favor ingresa tu nombre');
        return;
      }
      currentLevel = 1;
      score = 0;
      scoreSpan.textContent = score;
      startLevel(4);
    }

    function startLevel(pairs) {
      board.innerHTML = '';
      flippedCards = [];
      matchedPairs = 0;
      levelSpan.textContent = currentLevel;
      attempts = 2;
      attemptsSpan.textContent = attempts;
      rankingDiv.style.display = 'none';

      const selectedImages = imageList.slice(0, pairs);
      const cards = [...selectedImages, ...selectedImages]
        .sort(() => 0.5 - Math.random())
        .map(src => {
          const card = document.createElement('div');
          card.classList.add('card');
          card.dataset.src = src;
          card.addEventListener('click', handleCardClick);
          return card;
        });

      board.style.gridTemplateColumns = `repeat(${Math.ceil(Math.sqrt(pairs * 2))}, 1fr)`;
      cards.forEach(card => board.appendChild(card));

      remainingTime = getTimeForLevel(pairs);
      timeSpan.textContent = remainingTime;
      clearInterval(timer);
      timer = setInterval(() => {
        remainingTime--;
        timeSpan.textContent = remainingTime;
        if (remainingTime <= 0) {
          clearInterval(timer);
          endGame('¡Se acabó el tiempo!');
        }
      }, 1000);
    }

    function handleCardClick(e) {
      const card = e.currentTarget;
      if (card.children.length || flippedCards.length >= 2) return;

      const img = document.createElement('img');
      img.src = card.dataset.src;
      card.appendChild(img);
      flippedCards.push(card);

      if (flippedCards.length === 2) {
        const [first, second] = flippedCards;
        if (first.dataset.src === second.dataset.src) {
          matchedPairs++;
          score += 10;
          scoreSpan.textContent = score;
          flippedCards = [];
          if (matchedPairs === currentLevel * 2) {
            clearInterval(timer);
            if (currentLevel < maxPairs / 2) {
              currentLevel++;
              setTimeout(() => startLevel(currentLevel * 2), 1000);
            } else {
              endGame('¡Ganaste el juego completo!');
            }
          }
        } else {
          attempts--;
          attemptsSpan.textContent = attempts;
          if (attempts <= 0) {
            clearInterval(timer);
            endGame('¡Se acabaron los intentos!');
            return;
          }
          setTimeout(() => {
            flippedCards.forEach(c => c.innerHTML = '');
            flippedCards = [];
          }, 1000);
        }
      }
    }

    function endGame(message) {
      alert(message + ' Tu puntuación final es: ' + score);
      saveScore();
      showRanking();
    }

    function saveScore() {
      const scores = JSON.parse(localStorage.getItem('memoramaScores') || '[]');
      scores.push({ name: username, score });
      scores.sort((a, b) => b.score - a.score);
      localStorage.setItem('memoramaScores', JSON.stringify(scores));
    }

    function showRanking() {
      const scores = JSON.parse(localStorage.getItem('memoramaScores') || '[]');
      rankingDiv.innerHTML = '<h2>Ranking</h2>' +
        '<ol>' + scores.map(s => `<li>${s.name}: ${s.score} puntos</li>`).join('') + '</ol>';
      rankingDiv.style.display = 'block';
    }
  </script>
</body>
</html>
